<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="style2.css" />
    <link rel="stylesheet" href="header.css" />
    <link rel="stylesheet" href="generals.css" />
    <link rel="stylesheet" href="footer.css" />

    <link rel="icon" type="image/png" href="images/MDamida-logo.png" />
    <link rel="shortcut icon" href="images/MDamida-logo.png" type="image/png" />
    <link
      href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
    <title>EAA Maternité</title>
  </head>

  <body>
    <header class="navbar">
      <div class="menu" onclick="history.back()">←</div>

      <h3><strong>Maternité</strong></h3>
      <div
        class="cart"
        onclick="location.href = 'cart.html'"
        style="cursor: pointer"
      >
        <i class="fa fa-shopping-bag"></i>
        <span class="badge" id="cartCount"></span>
      </div>
    </header>

    <div class="categories">
      <div class="flex">
        <div class="category" id="allaitement" style="cursor: pointer">
          <img
            src="https://i.pinimg.com/1200x/24/c8/8b/24c88b15d09f2ca49fe0a1f5459a069c.jpg"
            alt=""
          />
          <p>Allaitement</p>
        </div>

        <div class="category" id="haut" style="cursor: pointer">
          <img
            src="https://i.pinimg.com/736x/6f/e8/50/6fe850aeea953760b460b0640da64ed0.jpg"
            alt=""
          />
          <p>Haut</p>
        </div>
        <div class="category" id="bas" style="cursor: pointer">
          <img
            src="https://i.pinimg.com/736x/6f/e8/50/6fe850aeea953760b460b0640da64ed0.jpg"
            alt=""
          />
          <p>Bas</p>
        </div>

        <div class="category" id="skincare" style="cursor: pointer">
          <img
            src="https://i.pinimg.com/736x/f3/ce/7b/f3ce7bdb41afe6dfccbd45f315cc1d9a.jpg"
            alt=""
          />
          <p>Maille</p>
        </div>

        <div class="category" id="fragrance" style="cursor: pointer">
          <img
            src="https://i.pinimg.com/1200x/60/e6/9e/60e69e948803f9e44bc18d02fbe4df7c.jpg"
            alt=""
          />
          <p>Chaussures</p>
        </div>
        <div class="category" id="accessoire" style="cursor: pointer">
          <img
            src="https://i.pinimg.com/736x/f3/ce/7b/f3ce7bdb41afe6dfccbd45f315cc1d9a.jpg"
            alt=""
          />
          <p>Accessoire</p>
        </div>
        <div class="category" id="tenuedeceremonie" style="cursor: pointer">
          <img
            src="https://i.pinimg.com/736x/90/66/9d/90669df004a2c05ec964b65b31349ef8.jpg"
            alt=""
          />
          <p>Tenue de cérémonie</p>
        </div>
        <div class="category" id="sac" style="cursor: pointer">
          <img
            src="https://i.pinimg.com/736x/d8/6d/68/d86d68af2d3e1b9a8062de5cb6aae948.jpg"
            alt=""
          />
          <p>Sac</p>
        </div>

        <div class="category" id="robe" style="cursor: pointer">
          <img
            src="https://i.pinimg.com/1200x/ef/e8/af/efe8af401c138c7e72f0159be6c0fd3f.jpg"
            alt=""
          />
          <p>Robe</p>
        </div>

        <div class="category" id="ensembledenuit" style="cursor: pointer">
          <img
            src="https://i.pinimg.com/1200x/d5/45/6a/d5456aa92060f3d1ff5b7e9d93c89158.jpg"
            alt=""
          />
          <p>Ensemble de nuit</p>
        </div>
        <div class="category" id="shooting" style="cursor: pointer">
          <img
            src="https://i.pinimg.com/1200x/90/52/db/9052dbae5f646aea2dc05519aabb949f.jpg"
            alt=""
          />
          <p>Shooting</p>
        </div>
        <div class="category" id="complet" style="cursor: pointer">
          <img
            src="https://i.pinimg.com/736x/c5/bf/f9/c5bff9b7e5e15b0e8cc265454709c6fe.jpg"
            alt=""
          />
          <p>Complet</p>
        </div>
      </div>
    </div>
    <p id="pTrie">Trier : <strong id="trieMessage"> </strong></p>
    <p id="articlesDisponible"></p>

    <section class="products" id="productsContainer"></section>

    <footer>
      <i class="fa fa-home" style="cursor: pointer">
        <p>Home</p>
      </i>
      <i
        class="fa fa-heart"
        onclick="location.href = 'wishlist.html'"
        style="cursor: pointer"
      ></i>
      <i
        class="fa fa-shopping-bag"
        onclick="location.href = 'cart.html'"
        style="cursor: pointer"
      >
        <p>cart</p>
      </i>
      <i class="fa fa-comments" onclick="showMenu()" style="cursor: pointer">
        <p>Chat</p>
      </i>
    </footer>
    <script>
      function getCategoryClasses(product) {
        const classes = [];

        // Add main category
        if (product.category) {
          classes.push(product.category.toLowerCase());
        }

        if (product.type) {
          classes.push(product.type.toLowerCase());
        }

        if (product.options?.size) {
          product.options.size.forEach((size) => {
            classes.push(size.toLowerCase());
          });
        }

        if (product.options?.color) {
          product.options.color.forEach((color) => {
            classes.push(color.toLowerCase());
          });
        }

        return classes.join(" "); // <- this is OK here
      }

      //*  PRODUCTS + WISHLIST

      const productsContainer = document.getElementById("productsContainer");

      // Load wishlist from localStorage
      let wishlist = JSON.parse(localStorage.getItem("wishlist")) || [];

      // Toggle wishlist (correct logic)
      function toggleWishlist(productId) {
        const index = wishlist.indexOf(productId);

        if (index === -1) {
          wishlist.push(productId); // add
        } else {
          wishlist.splice(index, 1); // remove
        }

        localStorage.setItem("wishlist", JSON.stringify(wishlist));
      }

      // Fetch products
      if (productsContainer) {
        fetch("./api/products")
          .then((res) => res.json())
          .then((productsObject) => {
            const productsArray = Object.values(productsObject);

            // Shuffle products
            for (let i = productsArray.length - 1; i > 0; i--) {
              const j = Math.floor(Math.random() * (i + 1));
              [productsArray[i], productsArray[j]] = [
                productsArray[j],
                productsArray[i],
              ];
            }

            renderProducts(productsArray);

            const categories = {
              haut: document.querySelectorAll(".haut"),
              bas: document.querySelectorAll(".bas"),
              complet: document.querySelectorAll(".complet"),
              chaussure: document.querySelectorAll(".chaussure"),
              accessoire: document.querySelectorAll(".accessoire"),
              sac: document.querySelectorAll(".sac"),

              bodies: document.querySelectorAll(".bodies"),

              pijama: document.querySelectorAll(".pijama"),

              robe: document.querySelectorAll(".robe"),

              mailles: document.querySelectorAll(".mailles"),
              tenuesdeceremonie:
                document.querySelectorAll(".tenuesdeceremonie"),
              allaitement: document.querySelectorAll(".allaitement"),
              ensembledenuit: document.querySelectorAll(".ensembledenuit"),
              Shooting: document.querySelectorAll(".shooting"),
            };
          });
      }

      // Render products
      function renderProducts(productsArray) {
        productsContainer.innerHTML = "";
        productsArray = productsArray.filter((p) => p.category === "Maternite");
        productsArray.forEach((p) => {
          const div = document.createElement("div");
          div.className = "product";
          div.dataset.id = p.id;

          if (p.isNew) {
            div.innerHTML += '<span class="new">Nouveau</span>';
          }
          if (p.isRunningLow) {
            div.innerHTML += '<span class="running-low">Bientôt épuisé</span>';
          }
          if (p.epuised) {
            div.innerHTML += '<span class="epuised">Épuisé</span>';
          }

          div.innerHTML = `
        <button class="wishlist-btn" data-id="${p.id}">
          <i class="fa ${wishlist.includes(p.id) ? "fa-solid" : "fa-regular"} fa-heart"></i>
        </button>

        <img src="${p.image}" alt="${p.name}" />

        <div class="info">
          <div class="price">$${p.price}</div>
          <button class="voir" onclick="window.location.href='product.html?id=${p.id}'">Voir</button>
        </div>
      `;
          productsContainer.appendChild(div);
        });

        attachWishlistEvents();
      }

      // Heart click
      function attachWishlistEvents() {
        document.querySelectorAll(".wishlist-btn").forEach((button) => {
          button.addEventListener("click", function (e) {
            e.stopPropagation(); // VERY IMPORTANT

            const productId = this.dataset.id;

            toggleWishlist(productId);

            const icon = this.querySelector("i");

            if (wishlist.includes(productId)) {
              icon.classList.remove("fa-regular");
              icon.classList.add("fa-solid");
              icon.style.color = "#ff0000";
              icon.style.textShadow = "0 0 5px #ff0000";
              icon.style.transition = "all 0.3s ease";
            } else {
              icon.classList.remove("fa-solid");
              icon.classList.add("fa-regular");
              icon.style.color = "";
              icon.style.textShadow = "";
              icon.style.transition = "all 0.3s ease";
            }
          });
        });
      }
    </script>
    <script src="mode.js"></script>
    <script src="filter.js"></script>
    <script src="cart.js"></script>
    <script src="cart-core.js"></script>
    <script src="product-link.js"></script>
  </body>
</html>
